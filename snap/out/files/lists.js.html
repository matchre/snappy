<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lists.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AlignmentMorph.html">AlignmentMorph</a></li>
            
                <li><a href="../classes/ArgLabelMorph.html">ArgLabelMorph</a></li>
            
                <li><a href="../classes/ArgMorph.html">ArgMorph</a></li>
            
                <li><a href="../classes/ArrowMorph.html">ArrowMorph</a></li>
            
                <li><a href="../classes/BlinkerMorph.html">BlinkerMorph</a></li>
            
                <li><a href="../classes/BlockDialogMorph.html">BlockDialogMorph</a></li>
            
                <li><a href="../classes/BlockEditorMorph.html">BlockEditorMorph</a></li>
            
                <li><a href="../classes/BlockExportDialogMorph.html">BlockExportDialogMorph</a></li>
            
                <li><a href="../classes/BlockHighlightMorph.html">BlockHighlightMorph</a></li>
            
                <li><a href="../classes/BlockImportDialogMorph.html">BlockImportDialogMorph</a></li>
            
                <li><a href="../classes/BlockInputFragmentMorph.html">BlockInputFragmentMorph</a></li>
            
                <li><a href="../classes/BlockLabelFragment.html">BlockLabelFragment</a></li>
            
                <li><a href="../classes/BlockLabelFragmentMorph.html">BlockLabelFragmentMorph</a></li>
            
                <li><a href="../classes/BlockLabelPlaceHolderMorph.html">BlockLabelPlaceHolderMorph</a></li>
            
                <li><a href="../classes/BlockMorph.html">BlockMorph</a></li>
            
                <li><a href="../classes/BooleanSlotMorph.html">BooleanSlotMorph</a></li>
            
                <li><a href="../classes/BouncerMorph.html">BouncerMorph</a></li>
            
                <li><a href="../classes/BoxMorph.html">BoxMorph</a></li>
            
                <li><a href="../classes/CellMorph.html">CellMorph</a></li>
            
                <li><a href="../classes/CircleBoxMorph.html">CircleBoxMorph</a></li>
            
                <li><a href="../classes/Color.html">Color</a></li>
            
                <li><a href="../classes/ColorPaletteMorph.html">ColorPaletteMorph</a></li>
            
                <li><a href="../classes/ColorPickerMorph.html">ColorPickerMorph</a></li>
            
                <li><a href="../classes/ColorSlotMorph.html">ColorSlotMorph</a></li>
            
                <li><a href="../classes/CommandBlockMorph.html">CommandBlockMorph</a></li>
            
                <li><a href="../classes/CommandSlotMorph.html">CommandSlotMorph</a></li>
            
                <li><a href="../classes/CommentMorph.html">CommentMorph</a></li>
            
                <li><a href="../classes/Context.html">Context</a></li>
            
                <li><a href="../classes/Costume.html">Costume</a></li>
            
                <li><a href="../classes/CostumeEditorMorph.html">CostumeEditorMorph</a></li>
            
                <li><a href="../classes/CostumeIconMorph.html">CostumeIconMorph</a></li>
            
                <li><a href="../classes/CSlotMorph.html">CSlotMorph</a></li>
            
                <li><a href="../classes/CursorMorph.html">CursorMorph</a></li>
            
                <li><a href="../classes/CustomBlockDefinition.html">CustomBlockDefinition</a></li>
            
                <li><a href="../classes/CustomCommandBlockMorph.html">CustomCommandBlockMorph</a></li>
            
                <li><a href="../classes/CustomReporterBlockMorph.html">CustomReporterBlockMorph</a></li>
            
                <li><a href="../classes/DialogBoxMorph.html">DialogBoxMorph</a></li>
            
                <li><a href="../classes/FrameMorph.html">FrameMorph</a></li>
            
                <li><a href="../classes/FunctionSlotMorph.html">FunctionSlotMorph</a></li>
            
                <li><a href="../classes/GrayPaletteMorph.html">GrayPaletteMorph</a></li>
            
                <li><a href="../classes/HandleMorph.html">HandleMorph</a></li>
            
                <li><a href="../classes/HandMorph.html">HandMorph</a></li>
            
                <li><a href="../classes/HatBlockMorph.html">HatBlockMorph</a></li>
            
                <li><a href="../classes/IDE_Morph.html">IDE_Morph</a></li>
            
                <li><a href="../classes/InputFieldMorph.html">InputFieldMorph</a></li>
            
                <li><a href="../classes/InputSlotDialogMorph.html">InputSlotDialogMorph</a></li>
            
                <li><a href="../classes/InputSlotMorph.html">InputSlotMorph</a></li>
            
                <li><a href="../classes/InspectorMorph.html">InspectorMorph</a></li>
            
                <li><a href="../classes/JaggedBlockMorph.html">JaggedBlockMorph</a></li>
            
                <li><a href="../classes/JukeboxMorph.html">JukeboxMorph</a></li>
            
                <li><a href="../classes/List.html">List</a></li>
            
                <li><a href="../classes/ListMorph.html">ListMorph</a></li>
            
                <li><a href="../classes/ListWatcherMorph.html">ListWatcherMorph</a></li>
            
                <li><a href="../classes/MenuItemMorph.html">MenuItemMorph</a></li>
            
                <li><a href="../classes/MenuMorph.html">MenuMorph</a></li>
            
                <li><a href="../classes/MouseSensorMorph.html">MouseSensorMorph</a></li>
            
                <li><a href="../classes/MultiArgMorph.html">MultiArgMorph</a></li>
            
                <li><a href="../classes/MyClass.html">MyClass</a></li>
            
                <li><a href="../classes/Node.html">Node</a></li>
            
                <li><a href="../classes/Note.html">Note</a></li>
            
                <li><a href="../classes/PaintCanvasMorph.html">PaintCanvasMorph</a></li>
            
                <li><a href="../classes/PaintEditorMorph.html">PaintEditorMorph</a></li>
            
                <li><a href="../classes/PenMorph.html">PenMorph</a></li>
            
                <li><a href="../classes/Point.html">Point</a></li>
            
                <li><a href="../classes/Process.html">Process</a></li>
            
                <li><a href="../classes/ProjectDialogMorph.html">ProjectDialogMorph</a></li>
            
                <li><a href="../classes/PrototypeHatBlockMorph.html">PrototypeHatBlockMorph</a></li>
            
                <li><a href="../classes/PushButtonMorph.html">PushButtonMorph</a></li>
            
                <li><a href="../classes/ReadStream.html">ReadStream</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/ReporterBlockMorph.html">ReporterBlockMorph</a></li>
            
                <li><a href="../classes/ReporterSlotMorph.html">ReporterSlotMorph</a></li>
            
                <li><a href="../classes/RingCommandSlotMorph.html">RingCommandSlotMorph</a></li>
            
                <li><a href="../classes/RingMorph.html">RingMorph</a></li>
            
                <li><a href="../classes/RingReporterSlotMorph.html">RingReporterSlotMorph</a></li>
            
                <li><a href="../classes/ScriptsMorph.html">ScriptsMorph</a></li>
            
                <li><a href="../classes/ScrollFrameMorph.html">ScrollFrameMorph</a></li>
            
                <li><a href="../classes/ShadowMorph.html">ShadowMorph</a></li>
            
                <li><a href="../classes/SliderButtonMorph.html">SliderButtonMorph</a></li>
            
                <li><a href="../classes/SliderMorph.html">SliderMorph</a></li>
            
                <li><a href="../classes/SnapSerializer.html">SnapSerializer</a></li>
            
                <li><a href="../classes/Sound.html">Sound</a></li>
            
                <li><a href="../classes/SoundIconMorph.html">SoundIconMorph</a></li>
            
                <li><a href="../classes/SpeechBubbleMorph.html">SpeechBubbleMorph</a></li>
            
                <li><a href="../classes/SpriteBubbleMorph.html">SpriteBubbleMorph</a></li>
            
                <li><a href="../classes/SpriteHighlightMorph.html">SpriteHighlightMorph</a></li>
            
                <li><a href="../classes/SpriteMorph.html">SpriteMorph</a></li>
            
                <li><a href="../classes/StageMorph.html">StageMorph</a></li>
            
                <li><a href="../classes/StagePrompterMorph.html">StagePrompterMorph</a></li>
            
                <li><a href="../classes/StringFieldMorph.html">StringFieldMorph</a></li>
            
                <li><a href="../classes/StringMorph.html">StringMorph</a></li>
            
                <li><a href="../classes/SVG_Costume.html">SVG_Costume</a></li>
            
                <li><a href="../classes/SymbolMorph.html">SymbolMorph</a></li>
            
                <li><a href="../classes/SyntaxElementMorph.html">SyntaxElementMorph</a></li>
            
                <li><a href="../classes/TabMorph.html">TabMorph</a></li>
            
                <li><a href="../classes/TemplateSlotMorph.html">TemplateSlotMorph</a></li>
            
                <li><a href="../classes/TextMorph.html">TextMorph</a></li>
            
                <li><a href="../classes/TextSlotMorph.html">TextSlotMorph</a></li>
            
                <li><a href="../classes/ThreadManager.html">ThreadManager</a></li>
            
                <li><a href="../classes/ToggleButtonMorph.html">ToggleButtonMorph</a></li>
            
                <li><a href="../classes/ToggleElementMorph.html">ToggleElementMorph</a></li>
            
                <li><a href="../classes/ToggleMorph.html">ToggleMorph</a></li>
            
                <li><a href="../classes/TriggerMorph.html">TriggerMorph</a></li>
            
                <li><a href="../classes/TurtleIconMorph.html">TurtleIconMorph</a></li>
            
                <li><a href="../classes/UpvarReference.html">UpvarReference</a></li>
            
                <li><a href="../classes/VariableDialogMorph.html">VariableDialogMorph</a></li>
            
                <li><a href="../classes/VariableFrame.html">VariableFrame</a></li>
            
                <li><a href="../classes/WardrobeMorph.html">WardrobeMorph</a></li>
            
                <li><a href="../classes/WatcherMorph.html">WatcherMorph</a></li>
            
                <li><a href="../classes/WorldMorph.html">WorldMorph</a></li>
            
                <li><a href="../classes/XML_Element.html">XML_Element</a></li>
            
                <li><a href="../classes/XML_Serializer.html">XML_Serializer</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lists.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*

    lists.js

    list data structure and GUI for SNAP!

    written by Jens Mönig and Brian Harvey
    jens@moenig.org, bh@cs.berkeley.edu

    Copyright (C) 2013 by Jens Mönig and Brian Harvey

    This file is part of Snap!.

    Snap! is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of
    the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.


    prerequisites:
    --------------
    needs morphic.js, widgets.js and gui.js


    I. hierarchy
    -------------
    the following tree lists all constructors hierarchically,
    indentation indicating inheritance. Refer to this list to get a
    contextual overview:

    List

    BoxMorph*
        ListWatcherMorph

    * from Morphic.js


    II. toc
    -------
    the following list shows the order in which all constructors are
    defined. Use this list to locate code in this document:

    List
    ListWatcherMorph

*/

// Global settings /////////////////////////////////////////////////////

/*global modules, contains, BoxMorph, WorldMorph, HandleMorph,
PushButtonMorph, SyntaxElementMorph, Color, Point, WatcherMorph,
StringMorph, SpriteMorph, ScrollFrameMorph, CellMorph, ArrowMorph,
MenuMorph, snapEquals, Morph, isNil, localize, MorphicPreferences*/

modules.lists = &#x27;2013-December-04&#x27;;

var List;
var ListWatcherMorph;

// List ////////////////////////////////////////////////////////////////
/**
* I am a dynamic array data structure for SNAP!
    My index starts with 1

    I am a &quot;smart&quot; hybrid list, because I can be used as both a linked
    list and as a dynamic array

    public interface:

        setters (linked):
        -----------------
        cons                - answer a new list with the given item in front
        cdr                    - answer all but the first element

    setters (arrayed):
    ------------------
        add(element, index)    - insert the element before the given slot,
        put(element, index)    - overwrite the element at the given slot
        remove(index)        - remove the given slot, shortening the list
        clear()                - remove all elements

    getters (all hybrid):
    ---------------------
        length()            - number of slots
        at(index)            - element present in specified slot
        contains(element)    - &lt;bool&gt;

    conversion:
    -----------
        asArray()            - answer me as JavaScript array
        asText()            - answer my elements (recursively) concatenated
*
* @class List
* @constructor
*/
/*
    I am a dynamic array data structure for SNAP!
    My index starts with 1

    I am a &quot;smart&quot; hybrid list, because I can be used as both a linked
    list and as a dynamic array

    public interface:

    setters (linked):
    -----------------
    cons                - answer a new list with the given item in front
    cdr                    - answer all but the first element

    setters (arrayed):
    ------------------
    add(element, index)    - insert the element before the given slot,
    put(element, index)    - overwrite the element at the given slot
    remove(index)        - remove the given slot, shortening the list
    clear()                - remove all elements

    getters (all hybrid):
    ---------------------
    length()            - number of slots
    at(index)            - element present in specified slot
    contains(element)    - &lt;bool&gt;

    conversion:
    -----------
    asArray()            - answer me as JavaScript array
    asText()            - answer my elements (recursively) concatenated
*/

// List instance creation:

function List(array) {
    this.contents = array || [];
    this.first = null;
    this.rest = null;
    this.isLinked = false;
    this.lastChanged = Date.now();
}

List.prototype.toString = function () {
    return &#x27;a List [&#x27; + this.asArray + &#x27;]&#x27;;
};

// List updating:

List.prototype.changed = function () {
    this.lastChanged = Date.now();
};

// Linked List ops:

List.prototype.cons = function (car, cdr) {
    var answer = new List();
    answer.first = isNil(car) ? null : car;
    answer.rest = cdr || null;
    answer.isLinked = true;
    return answer;
};

List.prototype.cdr = function () {
    function helper(i) {
        if (i &gt; this.contents.length) {
            return new List();
        }
        return this.cons(this.at(i), helper.call(this, i + 1));
    }
    if (this.isLinked) {
        return this.rest || new List();
    }
    if (this.contents.length &lt; 2) {
        return new List();
    }
    return helper.call(this, 2);
};

// List array setters:

List.prototype.add = function (element, index) {
/*
    insert the element before the given slot index,
    if no index is specifed, append the element
*/
    var idx = index || this.length() + 1,
        obj = element === 0 ? 0
                : element === false ? false
                        : element || null;
    this.becomeArray();
    this.contents.splice(idx - 1, 0, obj);
    this.changed();
};

List.prototype.put = function (element, index) {
    // exchange the element at the given slot for another
    var data = element === 0 ? 0
            : element === false ? false
                    : element || null;

    this.becomeArray();
    this.contents[index - 1] = data;
    this.changed();
};

List.prototype.remove = function (index) {
    // remove the given slot, shortening the list
    this.becomeArray();
    this.contents.splice(index - 1, 1);
    this.changed();
};

List.prototype.clear = function () {
    this.contents = [];
    this.first = null;
    this.rest = null;
    this.isLinked = false;
    this.changed();
};

// List getters (all hybrid):

List.prototype.length = function () {
    if (this.isLinked) {
        return (this.first === undefined ? 0 : 1)
            + (this.rest ? this.rest.length() : 0);
    }
    return this.contents.length;
};

List.prototype.at = function (index) {
    var value, idx = +index;
    if (this.isLinked) {
        return idx === 1 ? this.first : this.rest.at(idx - 1);
    }
    value = this.contents[idx - 1];
    return isNil(value) ? &#x27;&#x27; : value;
};

List.prototype.contains = function (element) {
    if (this.isLinked) {
        if (snapEquals(this.first, element)) {
            return true;
        }
        if (this.rest instanceof List) {
            return this.rest.contains(element);
        }
    }
    // in case I&#x27;m arrayed
    return this.contents.some(function (any) {
        return snapEquals(any, element);
    });
};

// List conversion:

List.prototype.asArray = function () {
    // for use in the evaluator
    this.becomeArray();
    return this.contents;
};

List.prototype.asText = function () {
    var result = &#x27;&#x27;,
        length = this.length(),
        element,
        i;
    for (i = 1; i &lt;= length; i += 1) {
        element = this.at(i);
        if (element instanceof List) {
            result = result.concat(element.asText());
        } else {
            element = isNil(element) ? &#x27;&#x27; : element.toString();
            result = result.concat(element);
        }
    }
    return result;
};

List.prototype.becomeArray = function () {
    if (this.isLinked) {
        var next = this;
        this.contents = [];
        while (next instanceof List &amp;&amp; (next.length() &gt; 0)) {
            this.contents.push(next.at(1));
            next = next.cdr();
        }
        this.isLinked = false;
    }
};

List.prototype.becomeLinked = function () {
    var i, stop, tail = this;
    if (!this.isLinked) {
        stop = this.length();
        for (i = 0; i &lt; stop; i += 1) {
            tail.first = this.contents[i];
            tail.rest = new List();
            tail.isLinked = true;
            tail = tail.rest;
        }
        this.contents = [];
        this.isLinked = true;
    }
};

// List testing

List.prototype.equalTo = function (other) {
    var i;
    if (!(other instanceof List)) {
        return false;
    }
    if ((!this.isLinked) &amp;&amp; (!other.isLinked)) {
        if (this.length() === 0 &amp;&amp; (other.length() === 0)) {
            return true;
        }
        if (this.length() !== other.length()) {
            return false;
        }
        for (i = 0; i &lt; this.length(); i += 1) {
            if (!snapEquals(this.contents[i], other.contents[i])) {
                return false;
            }
        }
        return true;
    }
    if ((this.isLinked) &amp;&amp; (other.isLinked)) {
        if (snapEquals(this.at(1), other.at(1))) {
            return this.cdr().equalTo(other.cdr());
        }
        return false;
    }
    if (this.length() !== other.length()) {
        return false;
    }
    for (i = 0; i &lt; this.length(); i += 1) {
        if (!snapEquals(this.at(i), other.at(i))) {
            return false;
        }
    }
    return true;
};

// ListWatcherMorph ////////////////////////////////////////////////////
/**
* I am a little window which observes a list and continuously
    updates itself accordingly
*
* @class ListWatcherMorph
* @constructor
*/
/*
    I am a little window which observes a list and continuously
    updates itself accordingly
*/

// ListWatcherMorph inherits from BoxMorph:

ListWatcherMorph.prototype = new BoxMorph();
ListWatcherMorph.prototype.constructor = ListWatcherMorph;
ListWatcherMorph.uber = BoxMorph.prototype;

// ListWatcherMorph default settings

ListWatcherMorph.prototype.cellColor =
    SpriteMorph.prototype.blockColor.lists;

// ListWatcherMorph instance creation:

function ListWatcherMorph(list, parentCell) {
    this.init(list, parentCell);
}

ListWatcherMorph.prototype.init = function (list, parentCell) {
    var myself = this;

    this.list = list || new List();
    this.start = 1;
    this.range = 100;
    this.lastUpdated = Date.now();
    this.lastCell = null;
    this.parentCell = parentCell || null; // for circularity detection

    // elements declarations
    this.label = new StringMorph(
        localize(&#x27;length: &#x27;) + this.list.length(),
        SyntaxElementMorph.prototype.fontSize,
        null,
        false,
        false,
        false,
        MorphicPreferences.isFlat ? new Point() : new Point(1, 1),
        new Color(255, 255, 255)
    );
    this.label.mouseClickLeft = function () {myself.startIndexMenu(); };


    this.frame = new ScrollFrameMorph(null, 10);
    this.frame.alpha = 0;
    this.frame.acceptsDrops = false;
    this.frame.contents.acceptsDrops = false;

    this.handle = new HandleMorph(
        this,
        80,
        70,
        3,
        3
    );
    this.handle.setExtent(new Point(13, 13));

    this.arrow = new ArrowMorph(
        &#x27;down&#x27;,
        SyntaxElementMorph.prototype.fontSize
    );
    this.arrow.mouseClickLeft = function () {myself.startIndexMenu(); };
    this.arrow.setRight(this.handle.right());
    this.arrow.setBottom(this.handle.top());
    this.handle.add(this.arrow);

    this.plusButton = new PushButtonMorph(
        this.list,
        &#x27;add&#x27;,
        &#x27;+&#x27;
    );
    this.plusButton.padding = 0;
    this.plusButton.edge = 0;
    this.plusButton.outlineColor = this.color;
    this.plusButton.drawNew();
    this.plusButton.fixLayout();

    ListWatcherMorph.uber.init.call(
        this,
        SyntaxElementMorph.prototype.rounding,
        1.000001, // shadow bug in Chrome,
        new Color(120, 120, 120)
    );

    this.color = new Color(220, 220, 220);
    this.isDraggable = true;
    this.setExtent(new Point(80, 70).multiplyBy(
        SyntaxElementMorph.prototype.scale
    ));
    this.add(this.label);
    this.add(this.frame);
    this.add(this.plusButton);
    this.add(this.handle);
    this.handle.drawNew();
    this.update();
    this.fixLayout();
};

// ListWatcherMorph updating:

ListWatcherMorph.prototype.update = function (anyway) {
    var i, idx, ceil, morphs, cell, cnts, label, button, max,
        starttime, maxtime = 1000;

    this.frame.contents.children.forEach(function (m) {

        if (m instanceof CellMorph
                &amp;&amp; m.contentsMorph instanceof ListWatcherMorph) {
            m.contentsMorph.update();
        }
    });

    if (this.lastUpdated === this.list.lastChanged &amp;&amp; !anyway) {
        return null;
    }

    this.updateLength(true);

    // adjust start index to current list length
    this.start = Math.max(
        Math.min(
            this.start,
            Math.floor((this.list.length() - 1) / this.range)
                * this.range + 1
        ),
        1
    );

    // refresh existing cells
    // highest index shown:
    max = Math.min(
        this.start + this.range - 1,
        this.list.length()
    );

    // number of morphs available for refreshing
    ceil = Math.min(
        (max - this.start + 1) * 3,
        this.frame.contents.children.length
    );

    for (i = 0; i &lt; ceil; i += 3) {
        idx = this.start + (i / 3);

        cell = this.frame.contents.children[i];
        label = this.frame.contents.children[i + 1];
        button = this.frame.contents.children[i + 2];
        cnts = this.list.at(idx);

        if (cell.contents !== cnts) {
            cell.contents = cnts;
            cell.drawNew();
            if (this.lastCell) {
                cell.setLeft(this.lastCell.left());
            }
        }
        this.lastCell = cell;

        if (label.text !== idx.toString()) {
            label.text = idx.toString();
            label.drawNew();
        }

        button.action = idx;
    }

    // remove excess cells
    // number of morphs to be shown
    morphs = (max - this.start + 1) * 3;

    while (this.frame.contents.children.length &gt; morphs) {
        this.frame.contents.children[morphs].destroy();
    }

    // add additional cells
    ceil = morphs; //max * 3;
    i = this.frame.contents.children.length;

    starttime = Date.now();
    if (ceil &gt; i + 1) {
        for (i; i &lt; ceil; i += 3) {
            if (Date.now() - starttime &gt; maxtime) {
                this.fixLayout();
                this.frame.contents.adjustBounds();
                this.frame.contents.setLeft(this.frame.left());
                return null;
            }
            idx = this.start + (i / 3);
            label = new StringMorph(
                idx.toString(),
                SyntaxElementMorph.prototype.fontSize,
                null,
                false,
                false,
                false,
                MorphicPreferences.isFlat ? new Point() : new Point(1, 1),
                new Color(255, 255, 255)
            );
            cell = new CellMorph(
                this.list.at(idx),
                this.cellColor,
                idx,
                this.parentCell
            );
            button = new PushButtonMorph(
                this.list.remove,
                idx,
                &#x27;-&#x27;,
                this.list
            );
            button.padding = 1;
            button.edge = 0;
            button.corner = 1;
            button.outlineColor = this.color.darker();
            button.drawNew();
            button.fixLayout();

            this.frame.contents.add(cell);
            if (this.lastCell) {
                cell.setPosition(this.lastCell.bottomLeft());
            } else {
                cell.setTop(this.frame.contents.top());
            }
            this.lastCell = cell;
            label.setCenter(cell.center());
            label.setRight(cell.left() - 2);
            this.frame.contents.add(label);
            this.frame.contents.add(button);
        }
    }
    this.lastCell = null;

    this.fixLayout();
    this.frame.contents.adjustBounds();
    this.frame.contents.setLeft(this.frame.left());
    this.updateLength();
    this.lastUpdated = this.list.lastChanged;
};

ListWatcherMorph.prototype.updateLength = function (notDone) {
    this.label.text = localize(&#x27;length: &#x27;) + this.list.length();
    if (notDone) {
        this.label.color = new Color(0, 0, 100);
    } else {
        this.label.color = new Color(0, 0, 0);
    }
    this.label.drawNew();
    this.label.setCenter(this.center());
    this.label.setBottom(this.bottom() - 3);
};

ListWatcherMorph.prototype.startIndexMenu = function () {
    var i,
        range,
        myself = this,
        items = Math.ceil(this.list.length() / this.range),
        menu = new MenuMorph(
            function (idx) {myself.setStartIndex(idx); },
            null,
            myself
        );
    menu.addItem(&#x27;1...&#x27;, 1);
    for (i = 1; i &lt; items; i += 1) {
        range = i * 100 + 1;
        menu.addItem(range + &#x27;...&#x27;, range);
    }
    menu.popUpAtHand(this.world());
};

ListWatcherMorph.prototype.setStartIndex = function (index) {
    this.start = index;
    this.list.changed();
};

ListWatcherMorph.prototype.fixLayout = function () {
    Morph.prototype.trackChanges = false;
    if (this.frame) {
        this.arrangeCells();
        this.frame.silentSetPosition(this.position().add(3));
        this.frame.bounds.corner = this.bounds.corner.subtract(new Point(
            3,
            17
        ));
        this.frame.drawNew();
        this.frame.contents.adjustBounds();
    }

    this.label.setCenter(this.center());
    this.label.setBottom(this.bottom() - 3);
    this.plusButton.setLeft(this.left() + 3);
    this.plusButton.setBottom(this.bottom() - 3);

    Morph.prototype.trackChanges = true;
    this.changed();

    if (this.parent &amp;&amp; this.parent.fixLayout) {
        this.parent.fixLayout();
    }
};

ListWatcherMorph.prototype.arrangeCells = function () {
    var i, cell, label, button, lastCell,
        end = this.frame.contents.children.length;
    for (i = 0; i &lt; end; i += 3) {
        cell = this.frame.contents.children[i];
        label = this.frame.contents.children[i + 1];
        button = this.frame.contents.children[i + 2];
        if (lastCell) {
            cell.setTop(lastCell.bottom());
        }
        if (label) {
            label.setTop(cell.center().y - label.height() / 2);
            label.setRight(cell.left() - 2);
        }
        if (button) {
            button.setCenter(cell.center());
            button.setLeft(cell.right() + 2);
        }
        lastCell = cell;
    }
    this.frame.contents.adjustBounds();
};

// ListWatcherMorph hiding/showing:

ListWatcherMorph.prototype.show = function () {
    ListWatcherMorph.uber.show.call(this);
    this.frame.contents.adjustBounds();
};

// ListWatcherMorph drawing:

ListWatcherMorph.prototype.drawNew = function () {
    WatcherMorph.prototype.drawNew.call(this);
    this.fixLayout();
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
