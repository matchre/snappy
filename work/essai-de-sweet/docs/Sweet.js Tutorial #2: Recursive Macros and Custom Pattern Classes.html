<!DOCTYPE html>
<html class="wf-bellopro-n4-active wf-fftisawebpro-i4-active wf-fftisawebpro-i7-active wf-fftisawebpro-n4-active wf-fftisawebpro-n7-active wf-quatroslab-i4-active wf-quatroslab-i7-active wf-quatroslab-n4-active wf-quatroslab-n7-active wf-active"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Sweet.js Tutorial #2: Recursive Macros and Custom Pattern Classes</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="http://jlongster.com/favicon.ico">

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/jlongster" title="Atom feed">

    <link rel="stylesheet" href="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/main.css" type="text/css">

    <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/ga.js" async="" type="text/javascript"></script><script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/hn.js"></script><script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/all.js" id="facebook-jssdk"></script><script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/widgets.js" id="twitter-wjs"></script><script type="text/javascript" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/eeq3shn.js"></script>
    <style type="text/css">.tk-bello-pro{font-family:"bello-pro",sans-serif;}.tk-ff-tisa-web-pro{font-family:"ff-tisa-web-pro",serif;}.tk-quatro-slab{font-family:"quatro-slab",serif;}</style><link href="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/d.css" rel="stylesheet"><script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    
  <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/embed.js" async="" type="text/javascript"></script><script charset="UTF-8" async="" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/alfie.js"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_reset > div{overflow:hidden}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}
.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_fluid span{width:100%}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
.fbpluginrecommendationsbarleft{left:10px}
.fbpluginrecommendationsbarright{right:10px}</style></head>
  <body data-twttr-rendered="true" id="Sweet-js-Tutorial--2--Recursive-Macros-and-Custom-Pattern-Classes" class="post">

    <header>
      <div class="titlebar"><a href="http://jlongster.com/">The Blog of James Long, a Mozilla webdev</a></div>

      
  

    </header>

    <div class="main clearfix">
      
<div class="extra ">
  <ul>
    <li><a href="https://twitter.com/jlongster">twitter</a></li>
    <li><a href="https://github.com/jlongster/">github</a></li>
    <li><a href="http://feeds.feedburner.com/jlongster">rss</a></li>
  </ul>
</div>


      <div class="main-wrapper clearfix">
      
<article class="clearfix">
  

  <h1>Sweet.js Tutorial #2: Recursive Macros and Custom Pattern Classes</h1>

  <div class="date">March 12 2014</div>

  <p>In the <a href="http://jlongster.com/Writing-Your-First-Sweet.js-Macro">first tutorial</a>,
 we covered the basic concepts of sweet.js macros. Now we will look at a
 few techniques which help build more complex macros: recursion and 
custom pattern classes.</p>

<p><em>All of these tutorials are available in the <a href="https://github.com/jlongster/sweet.js-tutorials">sweet.js-tutorials</a> repo along with a working environment to build sweet.js macros.</em></p>

<p>For this tutorial, let's build a macro that implements ES6 <a href="http://wiki.ecmascript.org/doku.php?id=harmony:destructuring">variable destructuring</a>. You might start with something like this:</p>

<div class="macro-editor" id="var1"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 415px; margin-left: 0px; min-height: 286.417px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-keyword">let</span> <span class="cm-keyword">var</span> = <span class="cm-variable">macro</span> {</pre><pre>  <span class="cm-variable">rule</span> { [<span class="cm-variable">$var</span> (,) <span class="cm-meta">...</span>] = <span class="cm-variable">$obj</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">i</span> = <span class="cm-number">0</span>;</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">arr</span> = <span class="cm-variable">$obj</span>;</pre><pre>    <span class="cm-variable">$</span>(<span class="cm-keyword">var</span> <span class="cm-variable">$var</span> = <span class="cm-variable">arr</span>[<span class="cm-variable">i</span>++]) (;) <span class="cm-meta">...</span></pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$id</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$id</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">foo</span>, <span class="cm-variable">bar</span>, <span class="cm-variable">baz</span>] = <span class="cm-variable">arr</span>;</pre></div><div style="left: 4px; top: 2.70001px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 286.417px;"></div><div style="display: none; height: 286.417px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 317.017px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 226px; margin-left: 0px; min-height: 115.083px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-keyword">var</span> <span class="cm-variable">i</span> = <span class="cm-number">0</span>;</pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">arr$2</span> = <span class="cm-variable">arr</span>;</pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">foo</span> = <span class="cm-variable">arr$2</span>[<span class="cm-variable">i</span>++];</pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">bar</span> = <span class="cm-variable">arr$2</span>[<span class="cm-variable">i</span>++];</pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">baz</span> = <span class="cm-variable">arr$2</span>[<span class="cm-variable">i</span>++];</pre></div><div style="left: 4px; top: 2.70001px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 115.083px;"></div><div style="display: none; height: 286px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#var1" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div style="display: none;" class="status error"></div></div>

<p>This is a very basic attempt that only handles simple array<br>destructuring. We assign the target object to <code>arr</code> to make sure that expressions are only evaluated once. ES6 destructuring handles a lot more complex stuff: </p>

<ul>
<li>Object/hash destructuring: <code>var {foo, bar} = obj;</code></li>
<li>Defaults: <code>var [foo, bar=5] = arr;</code></li>
<li>Renaming: <code>var {foo: myFoo} = obj;</code></li>
<li>Nested destructuring: <code>var {foo, bar: [x, y]} = obj;</code></li>
</ul>

<p>You can write the above macro with all of the concepts learned in the
 first tutorial, but if you tried to support the above versatile syntax 
you probably got stuck. Now we will look at a few techniques for 
handling more complex use cases.</p>

<h2>Recursive Macros</h2>

<p>I mentioned recursive macros in the first tutorial briefly, but they 
are worth looking at more closely for how you can use them to solve 
common problems.</p>

<p>The output of a macro is always expanded again by sweet.js, so 
writing recursive macros is as natural as writing recursive functions. 
You simply have a rule that invokes your macro again, and another rule 
that matches the stopping case and stops expansion.</p>

<p>A common use case for recursive macros is processing a list that has 
non-uniform syntax. Usually you match a list of syntax with the 
repeating form <code>$item (,) ...</code>, and you can even match complex syntax with groups: <code>$($item = $arr[$i]) ...</code>. The problem is that each item in the list <em>must</em> have the same structure. You can't match various types of syntax within the list. sweet.js doesn't have the OR <code>|</code> operator or the optional operator <code>?</code> like regexes do.</p>

<p>For example, say you wanted to match a list of names that might have an initializer value: <code>x, y, z=5, w=6</code>.
 We want to iterate through the items and generate different code if the
 initializer value exists. Here's how you could do that recursively:</p>

<div class="macro-editor" id="var1b"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 469px; margin-left: 0px; min-height: 414.918px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-variable">macro</span> <span class="cm-variable">define</span> {</pre><pre>  <span class="cm-variable">rule</span> { , <span class="cm-variable">$item</span> = <span class="cm-variable">$init</span>:<span class="cm-variable">expr</span> <span class="cm-variable">$rest</span> <span class="cm-meta">...</span> ; } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$item</span> = <span class="cm-variable">$init</span>;</pre><pre>    <span class="cm-variable">define</span> <span class="cm-variable">$rest</span> <span class="cm-meta">...</span> ;</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { , <span class="cm-variable">$item</span> <span class="cm-variable">$rest</span> <span class="cm-meta">...</span> ; } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$item</span>;</pre><pre>    <span class="cm-variable">define</span> <span class="cm-variable">$rest</span> <span class="cm-meta">...</span> ;</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { ; } =&gt; { ; }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$items</span> <span class="cm-meta">...</span> ; } =&gt; {</pre><pre>    <span class="cm-variable">define</span> , <span class="cm-variable">$items</span> <span class="cm-meta">...</span> ;</pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">define</span> <span class="cm-variable">x</span>, <span class="cm-variable">y</span>, <span class="cm-variable">z</span>=<span class="cm-number">5</span>, <span class="cm-variable">w</span>=<span class="cm-number">6</span>;</pre></div><div style="left: 4px; top: 2.69995px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 414.918px;"></div><div style="display: none; height: 415px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 445.517px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 46px; margin-left: 0px; min-height: 29.4167px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre>&nbsp;</pre></div><div style="left: 4px; top: 2.69995px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 29.4167px;"></div><div style="display: none; height: 415px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#var1b" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div class="status error"></div></div>

<p>When using recursive macros, you typically need to handle edge cases 
like trailing commas. Since we are matching on a comma-delimited list of
 items, we need to strip the comma off, but we can't assume there's 
always a comma because the last item doesn't have one after it. We solve
 this by adding a comma at the beginning of the list, and then stripping
 that comma off when iterating through the list. Since the initial 
invoke never has a comma in front, it will fall through to the last rule
 which adds the comma and recursively invokes.</p>

<p>When there are no more items left, only <code>;</code> exists so it matches the third rule which simply outpus <code>;</code> and stops iterating.</p>

<p>Now is a good time to remind you that you can step through macro 
expansion by pressing "step" in the editor. Stepping is invaluable when 
debugging recursive macros. You can watch how it expands the form piece 
by piece.</p>

<p>So you can see how expanding this way gives you a lot of control over
 expansion. Now let's look at a more complex example. Let's try to add a
 feature to our original destructuring macro: the ability the specify 
default values. So you can use an array form with a comma-delimited list
 of variable names, and optionally an <code>=</code> specifying a default value if the element does not exist. <code>var [foo, bar=5] = ...</code> and <code>var [foo, bar=5, baz] = ...</code> are all valid.</p>

<p>First, note how we used a <code>let</code> macro in our first example: <code>let var = macro { ... }</code>. Remember what that does? It tells sweet.js that any <code>var</code> we generate should not be recursively expanded.</p>

<p>We need to create a helper macro which will be recursive, since we can't make <code>var</code> recursive. Here's how you could implement destructuring with the optional initializer form:</p>

<div class="macro-editor" id="var2"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px; display: block; right: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 624px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 622px; margin-left: 0px; min-height: 607.662px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-variable">macro</span> <span class="cm-variable">destruct_array</span> {</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [] } =&gt; {}</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$var</span>:<span class="cm-variable">ident</span> = <span class="cm-variable">$init</span>:<span class="cm-variable">expr</span>, <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ] } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$var</span> = <span class="cm-variable">$obj</span>[<span class="cm-variable">$i</span>++] || <span class="cm-variable">$init</span>;</pre><pre>    <span class="cm-variable">destruct_array</span> <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ]</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$var</span>:<span class="cm-variable">ident</span>, <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ] } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$var</span> = <span class="cm-variable">$obj</span>[<span class="cm-variable">$i</span>++];</pre><pre>    <span class="cm-variable">destruct_array</span> <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ]</pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-keyword">let</span> <span class="cm-keyword">var</span> = <span class="cm-variable">macro</span> {</pre><pre>  <span class="cm-variable">rule</span> { [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span>] = <span class="cm-variable">$obj</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">arr</span> = <span class="cm-variable">$obj</span>;</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">i</span> = <span class="cm-number">0</span>;</pre><pre>    <span class="cm-variable">destruct_array</span> <span class="cm-variable">arr</span> <span class="cm-variable">i</span> [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> , ]</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$id</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$id</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, <span class="cm-variable">y</span>] = <span class="cm-variable">arr</span>;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, <span class="cm-variable">y</span>, <span class="cm-variable">z</span>=<span class="cm-number">10</span>] = <span class="cm-variable">arr</span>;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 607.662px;"></div><div style="display: none; height: 608px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 653.267px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 46px; margin-left: 0px; min-height: 29.4165px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre>&nbsp;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 29.4165px;"></div><div style="display: none; height: 623px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#var2" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div class="status error"></div></div>

<p>The <code>var</code> macro returns syntax that contains the <code>destruct_array</code> macro, and sweet.js recursively expands it. This is a little complicated, but it's not too bad. Let's walk through it:</p>

<ul>
<li><code>destruct_array</code> is the recursive macro that expands only
 one item of the array at a time. It does this by matching on the first 
item, generating code for it, and emitting another invocation of <code>destruct_array</code> with the rest of the items. When there are no more items to expand, it simply stops.</li>
<li>In the <code>var</code> macro, we added an extra comma at the end of the array that is the third the argument to <code>destruct_array</code>. This makes it easy to <code>destruct_array</code> to pick off the first item because it can always assume there is a trailing comma.</li>
<li><code>$pattern ...</code> matches 0 or more elements, so <code>[ $var, $pattern ]</code> will match the last item like <code>[ x , ]</code>, strip it off, and then <code>[]</code> will match the rule which stops recursion.</li>
<li>We don't need to use the pattern <code>$pattern (,) ...</code> even though we are matching comma-delimited items. All we are doing it passing along whatever <code>$pattern ...</code> is and not processing the items, so it can match everything including the commas.</li>
</ul>

<p>Here's how <code>var [x, y=5] = expr</code> is expanded:</p>

<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> [x, y=<span class="number">5</span>] = expr;

<span class="keyword">var</span> arr = expr;
<span class="keyword">var</span> i = <span class="number">0</span>;
destruct_array arr i [ x , y = <span class="number">5</span> , ];

<span class="keyword">var</span> arr = expr;
<span class="keyword">var</span> i = <span class="number">0</span>;
<span class="keyword">var</span> x = arr [ i ++ ];
destruct_array arr i [ y = <span class="number">5</span> , ];

<span class="keyword">var</span> arr = expr;
<span class="keyword">var</span> i = <span class="number">0</span>;
<span class="keyword">var</span> x = arr [ i ++ ];
<span class="keyword">var</span> y = arr [ i ++ ] || <span class="number">5</span>;
destruct_array arr i [ ];

<span class="keyword">var</span> arr = expr;
<span class="keyword">var</span> i = <span class="number">0</span>;
<span class="keyword">var</span> x = arr [ i ++ ];
<span class="keyword">var</span> y = arr [ i ++ ] || <span class="number">5</span>;
</code></pre></div>

<p>It's also worth noting that there are a few places in JavaScript 
where you can't invoke macros. If you are using helper/recursive macros 
you need to watch out for this. For example, you can't run macros in the
 place of <code>var</code> bindings or function argument names. <code>var invoke_macro { do_something_weird }</code> does not work, and <code>function foo(invoke_macro {}) {}</code> doesn't either.</p>

<p>That means that you can't do a macro like this:</p>

<div class="macro-editor" id="var3"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 406px; margin-left: 0px; min-height: 243.582px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-variable">macro</span> <span class="cm-variable">randomized</span> {</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">RANDOM</span> <span class="cm-variable">$var</span> } =&gt; {</pre><pre>    <span class="cm-variable">$var</span> = <span class="cm-variable">Math</span>.<span class="cm-property">random</span>()</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$var</span> (,) <span class="cm-meta">...</span>; } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$</span>(<span class="cm-variable">randomized</span> <span class="cm-variable">RANDOM</span> <span class="cm-variable">$var</span>) (,) <span class="cm-meta">...</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">randomized</span> <span class="cm-variable">x</span>, <span class="cm-variable">y</span>, <span class="cm-variable">z</span>;</pre></div><div style="left: 4px; top: 2.69971px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 243.582px;"></div><div style="display: none; height: 244px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 274.183px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 46px; margin-left: 0px; min-height: 29.4165px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre>&nbsp;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 29.4165px;"></div><div style="display: none; height: 244px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#var3" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div class="status error"></div></div>

<p>However, if you <a href="#var3" data-editor-change="rec1">remove the <code>var</code></a> it works. What you really want here is the ability to <strong>locally expand</strong> syntax inside the rule, but sweet.js does not support this yet.</p>

<p>Ideally our macro should expand to a single <code>var</code> statement like <code>var arr = expr, i = 0, x = arr[i++]</code> instead of multiple <code>var</code> statements. Our current macro won't work in <code>for</code> and <code>while</code> statements (<code>for(var [x, y] = arr; x&lt;10; x++) {}</code>) because multiple statements are invalid there. Unfortunately, we would need to recursively invoke a macro in the <code>var</code> binding place but we can't do that as explained above. The macro would look like <code>var destruct_array arr i [ $pattern ... , END ]</code>, but you can't do that.</p>

<p>Let's continue working on the destructuring macro and add support for nested destructuring. You should be able to do <code>var [x, [y, z]] = arr</code>
 but our macro doesn't handle that. Because we of recursive macros, it 
turns out to be really easy to add that. All we need to do is relax the 
accepted token type in <code>destruct_array</code> to accept anything (<code>$var:id</code> was changed to <code>$first</code>) and switch the order of macros.</p>

<div class="macro-editor" id="var4"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px; display: block; right: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 624px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 622px; margin-left: 0px; min-height: 629.088px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-keyword">let</span> <span class="cm-keyword">var</span> = <span class="cm-variable">macro</span> {</pre><pre>  <span class="cm-variable">rule</span> { [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span>] = <span class="cm-variable">$obj</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">arr</span> = <span class="cm-variable">$obj</span>;</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">i</span> = <span class="cm-number">0</span>;</pre><pre>    <span class="cm-variable">destruct_array</span> <span class="cm-variable">arr</span> <span class="cm-variable">i</span> [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> , <span class="cm-variable">END</span> ]</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$id</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$id</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">macro</span> <span class="cm-variable">destruct_array</span> {</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">END</span> ] } =&gt; {</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$var</span>:<span class="cm-variable">ident</span> = <span class="cm-variable">$init</span>:<span class="cm-variable">expr</span>, <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ] } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$var</span> = <span class="cm-variable">$obj</span>[<span class="cm-variable">$i</span>++] || <span class="cm-variable">$init</span>;</pre><pre>    <span class="cm-variable">destruct_array</span> <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ]</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$first</span>, <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ] } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$first</span> = <span class="cm-variable">$obj</span>[<span class="cm-variable">$i</span>++];</pre><pre>    <span class="cm-variable">destruct_array</span> <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> [ <span class="cm-variable">$pattern</span> <span class="cm-meta">...</span> ]</pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, <span class="cm-variable">y</span>] = <span class="cm-variable">arr</span>;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, [<span class="cm-variable">y</span>=<span class="cm-number">5</span>, <span class="cm-variable">z</span>]] = <span class="cm-variable">arr</span>;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 629.088px;"></div><div style="display: none; height: 629.088px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 674.683px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 46px; margin-left: 0px; min-height: 29.417px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre>&nbsp;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 29.417px;"></div><div style="display: none; height: 644px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#var4" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div class="status error"></div></div>

<p>We switched the order of <code>var</code> and <code>destruct_array</code> because we use <code>var</code> in <code>destruct_array</code> to create the new identifiers and initialize them to the right element. If the "element" is actually <em>another</em> pattern like <code>[y, z]</code> we want to destructure that. Can't we simply use our <code>var</code> macro to recursively destructure it? Yes, we can! Right now, <code>let</code> macros are only available after they are defined, so if we define <code>destruct_array</code> afterwards it will recursively expand into it.</p>

<p>Recursive macros give you more control over expansion. I'll leave it up to the reader to add object destructuring (<code>var {x, y: foo} = obj</code>).
 While recursiveness is useful, let's look at another way to match 
complex patterns that can be more intuitive and easier to use.</p>

<h2>Custom Pattern Classes</h2>

<p>In the first tutorial I mentioned pattern classes which tell the expander what kinds of tokens to match. <code>ident</code>, <code>lit</code>, and <code>expr</code> are builtin to sweet.js. You can actually define your own pattern classes as well to abstract away complex pattern matching.</p>

<p>The common issue here is the need for building abstractions, which is
 especially necessary when you want to match things like repeated 
patterns. Recursive macros allow you to build helper macros that make 
those layers of abstraction. Custom pattern classes allow you to as 
well, but they are more intuitive.</p>

<p>It's very simple to make your own pattern class: just make a macro! A
 macro can be invoked as a pattern class simply by using it as one 
(given a macro <code>foo</code>, use <code>rule { $x:foo } =&gt; {}</code>). There are also two forms you can use: <code>$x:invoke(foo)</code> and <code>$x:invokeOnce(foo)</code>. <code>invoke</code> will recursively expand the result of the <code>foo</code> macro, and <code>invokeOnce</code> will just expand it once. <code>$x:foo</code> is just a shorthand for <code>$x:invoke(foo)</code>.</p>

<p>Here is the recursive <code>define</code> macro that we made before, but using pattern classes instead:</p>

<div class="macro-editor" id="pat1"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 370px; margin-left: 0px; min-height: 372.089px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-variable">macro</span> <span class="cm-variable">item</span> {</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$item</span> = <span class="cm-variable">$init</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$item</span> = <span class="cm-variable">$init</span></pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$item</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$item</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">macro</span> <span class="cm-variable">define</span> {</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$items</span>:<span class="cm-variable">item</span> (,) <span class="cm-meta">...</span> ; } =&gt; {</pre><pre>    <span class="cm-variable">$items</span> (;) <span class="cm-meta">...</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">define</span> <span class="cm-variable">x</span>, <span class="cm-variable">y</span>, <span class="cm-variable">z</span>=<span class="cm-number">5</span>, <span class="cm-variable">w</span>=<span class="cm-number">6</span>;</pre></div><div style="left: 4px; top: 2.69922px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 372.089px;"></div><div style="display: none; height: 372.089px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 402.683px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 46px; margin-left: 0px; min-height: 29.417px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre>&nbsp;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 29.417px;"></div><div style="display: none; height: 372px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#pat1" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div class="status error"></div></div>

<p>A pattern class runs the macro on the current stream of tokens, and is replaced by whatever the macro is expanded to.  The <code>item</code> macro returns the <code>var</code> definitions, and all we have to do in <code>define</code> is output <code>$items</code>.
 Pattern classes are easier for many use cases than recursive patterns 
because you don't have to do the bookkeeping of trailing commas and 
such.</p>

<p>If <code>item</code> returned code that had a macro as the first 
token, it would be continually expanded. Any macros anywhere else in the
 code are not expanded; recursiveness with <code>$items:invoke(item)</code> or <code>$items:item</code> only applies to a macro returned in the "head" position. If you don't want that to happen, use <code>$items:invokeOnce(item)</code> to get back just the initial match.</p>

<p>What would our destructure macro look like with pattern classes 
instead of recursive macros? You think we might be able to do something 
like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="keyword">let</span> <span class="keyword">var</span> = macro {
  rule { [ $pattern:destruct_array (,) ...] = $obj:expr } =&gt; {
    $pattern (,) ...
  }

  rule { $id } =&gt; {
    <span class="keyword">var</span> $id
  }
}
</code></pre></div>

<p>The problem is that we need to pass parameters to <code>destruct_array</code>.
 We can do this by transforming the list of elements to include them for
 every element, and then use a helper macro to fire off the pattern 
class:</p>

<div class="highlight"><pre><code class="javascript"><span class="keyword">let</span> <span class="keyword">var</span> = macro {
  rule { [ $pattern:expr (,) ...] = $obj:expr } =&gt; {
    <span class="keyword">var</span> arr = $obj;
    <span class="keyword">var</span> i = <span class="number">0</span>;
    destruct [ $(arr i $pattern) (,) ... ]
  }

  rule { $id } =&gt; {
    <span class="keyword">var</span> $id
  }
}

macro destruct {
  rule { [ $pattern:destruct_array (,) ... ] } =&gt; {
    $pattern (;) ...
  }
}
</code></pre></div>

<p>We create the <code>arr</code> and <code>i</code> variables that we need to track destructuring state, and create a list of items that <code>destruct</code> can pick apart with <code>destruct_array</code>. Now we just need to define <code>destruct_array</code>. Here's the full macro:</p>

<div class="macro-editor" id="pat2"><div class="title"><strong>stepping</strong>: <span></span></div><div class="content"><div style="width: 500px;" class="CodeMirror cm-s-ambiance input"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px; display: block; right: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 507px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 505px; margin-left: 0px; min-height: 757.595px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre><span class="cm-keyword">let</span> <span class="cm-keyword">var</span> = <span class="cm-variable">macro</span> {</pre><pre>  <span class="cm-variable">rule</span> { [ <span class="cm-variable">$pattern</span>:<span class="cm-variable">expr</span> (,) <span class="cm-meta">...</span>] = <span class="cm-variable">$obj</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">arr</span> = <span class="cm-variable">$obj</span>;</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">i</span> = <span class="cm-number">0</span>;</pre><pre>    <span class="cm-variable">destruct</span> [ <span class="cm-variable">$</span>(<span class="cm-variable">arr</span> <span class="cm-variable">i</span> <span class="cm-variable">$pattern</span>) (,) <span class="cm-meta">...</span> ]</pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$id</span> = <span class="cm-variable">$init</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$id</span> = <span class="cm-variable">$init</span></pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$id</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$id</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">macro</span> <span class="cm-variable">destruct_array</span> {</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> <span class="cm-variable">$var</span> = <span class="cm-variable">$init</span>:<span class="cm-variable">expr</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$var</span> = <span class="cm-variable">$obj</span>[<span class="cm-variable">$i</span>++] || <span class="cm-variable">$init</span></pre><pre>  }</pre><pre>&nbsp;</pre><pre>  <span class="cm-variable">rule</span> { <span class="cm-variable">$obj</span> <span class="cm-variable">$i</span> <span class="cm-variable">$var</span> } =&gt; {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-variable">$var</span> = <span class="cm-variable">$obj</span>[<span class="cm-variable">$i</span>++]</pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-variable">macro</span> <span class="cm-variable">destruct</span> {</pre><pre>  <span class="cm-variable">rule</span> { [ <span class="cm-variable">$pattern</span>:<span class="cm-variable">destruct_array</span> (,) <span class="cm-meta">...</span> ] } =&gt; {</pre><pre>    <span class="cm-variable">$pattern</span> (;) <span class="cm-meta">...</span></pre><pre>  }</pre><pre>}</pre><pre>&nbsp;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, <span class="cm-variable">y</span>] = <span class="cm-variable">arr</span>;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, <span class="cm-variable">y</span>, <span class="cm-variable">z</span>=<span class="cm-number">10</span>] = <span class="cm-variable">arr</span>;</pre><pre><span class="cm-keyword">var</span> [<span class="cm-variable">x</span>, [<span class="cm-variable">y</span>, <span class="cm-variable">z</span>=<span class="cm-number">10</span>]] = <span class="cm-variable">arr</span>;</pre></div><div style="left: 4px; top: 2.7002px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 757.595px;"></div><div style="display: none; height: 758px;" class="CodeMirror-gutters"></div></div></div><div style="width: 500px; height: 803.2px;" class="CodeMirror cm-s-ambiance output"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 22px; left: 19.3px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none; font-size: 4px;"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="min-width: 46px; margin-left: 0px; min-height: 29.417px;" class="CodeMirror-sizer"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1; display: none;"></div><div style="" class="CodeMirror-code"><pre>&nbsp;</pre></div><div style="left: 4px; top: 2.69922px; height: 16px;" class="CodeMirror-cursor">&nbsp;</div><div style="display: none;" class="CodeMirror-cursor CodeMirror-secondarycursor">&nbsp;</div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 29.417px;"></div><div style="display: none; height: 773px;" class="CodeMirror-gutters"></div></div></div><div class="controls">  <button class="reset">Revert to Original</button>  <button class="open-stepper">Open Stepper</button>  <a href="#pat2" class="permalink">    <img src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/permalink-grey.png">  </a></div><div class="stepper"><div class="content"></div><div class="controls">  <button class="step">Step</button>  <button class="close-stepper">Close</button></div></div></div><div class="status error"></div></div>

<p>This supports both the initializer form (<code>var [x=5] = arr</code>) and nested destructuring. It's really interesting how nested destructuring works here: the <code>var</code> generated by <code>destruct_array</code>
 is referencing our macro so it is recursively expanded. Recursiveness 
still works with pattern classes, but you have to be careful. Whatever 
is returned by our <code>var</code> macro is what is injected into the match in <code>destruct</code>. Notice how we added another rule in <code>var</code> to match the normal <code>$id = $init:expr</code> form. We needed that so that it returned the full expression to <code>destruct</code> when recursively expanding.</p>

<p>Currently you can't step through pattern class expansion, but here's what it looks like:</p>

<div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> [x, y=<span class="number">5</span>] = expr;

<span class="keyword">var</span> arr = expr;
<span class="keyword">var</span> i = <span class="number">0</span>;
destruct [ arr i x , arr i y = <span class="number">5</span> ]

<span class="comment">// pattern class running: `destruct_array arr i x`</span>
arr i x

<span class="keyword">var</span> x = arr[i++]

<span class="comment">// expanded with `var` macro</span>
<span class="keyword">var</span> x = arr[i++]

<span class="comment">// pattern class running: `destruct_array arr i y = 5`</span>
arr i y = <span class="number">5</span>

<span class="keyword">var</span> y = arr[i++] || <span class="number">5</span>

<span class="comment">// expanded with `var` macro</span>
<span class="keyword">var</span> y = arr[i++] || <span class="number">5</span>

<span class="comment">// back inside `destruct`</span>

<span class="keyword">var</span> x = arr[i++];
<span class="keyword">var</span> y = arr[i++] || <span class="number">5</span>;
</code></pre></div>

<p>This macro can now do everything our recursive macro can do, and it's
 cleaner. It also gets us closer to the possibility of generating a 
single <code>var</code> statement like <code>var arr = expr, i = 0, x = arr[i++]</code> because pattern classes let us use repeaters. The form <code>var $el (,) ...</code> is valid because it's expanded before handed back to the parser; you just can't recursively expand in the place of a <code>var</code> binding.</p>

<p>Unfortunately, since we need to create two new bindings <code>arr</code> and <code>i</code> we can't generate a single var statement. The <code>var</code> macros makes those bindings and then invokes the <code>destruct</code> macro, so that macro invocation can't be in a <code>var</code> binding place. The only thing that will really allow us to generate a single <code>var</code> statement is the ability to manually locally expand syntax inside a macro rule, but we don't support that yet.</p>

<h2>End of Part II</h2>

<p>You can create a lot of interesting macros using both of these 
techniques. In the future we will cover things like infix macros, case 
macros, and much more. Stay tuned and <a href="http://feeds.feedburner.com/jlongster">follow my blog</a> for future tutorials!</p>

<script type="text/javascript" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/codemirror.js"></script>

<p><link rel="stylesheet" href="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/codemirror.css"><br><link rel="stylesheet" href="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/ambiance.css"><br><link rel="stylesheet" href="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/style.css"></p>

<script type="text/javascript" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/javascript.js"></script>

<script type="text/javascript" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/escodegen.js"></script>

<script type="text/javascript" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/editor.js"></script>

  <div class="tags">
    
    <a href="http://jlongster.com/tag/js">js</a>
    
    <a href="http://jlongster.com/tag/macros">macros</a>
    
  </div>

  <div class="social">
    <div class="social-buttons">
      <div>
        <iframe style="width: 128px; height: 20px;" data-twttr-rendered="true" title="Twitter Tweet Button" class="twitter-share-button twitter-tweet-button twitter-count-horizontal" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/tweet_button.html" allowtransparency="true" id="twitter-widget-0" scrolling="no" frameborder="0"></iframe>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>

      <div>
        <div fb-iframe-plugin-query="app_id=203253883025618&amp;font=verdana&amp;href=http%3A%2F%2Fjlongster.com%2FSweet.js-Tutorial--2--Recursive-Macros-and-Custom-Pattern-Classes&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;show_faces=false&amp;width=70" fb-xfbml-state="rendered" class="fb-like fb_iframe_widget" data-send="false" data-layout="button_count" data-width="70" data-show-faces="false" data-font="verdana"><span style="vertical-align: bottom; width: 86px; height: 25px;"><iframe class="" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/like.html" style="border: medium none; visibility: visible; width: 86px; height: 25px;" title="fb:like Facebook Social Plugin" allowtransparency="true" name="f2220d26599e3c4" scrolling="no" width="70px" frameborder="0" height="1000px"></iframe></span></div>

        <div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/LEdxGgtB9cN.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_http" allowtransparency="true" name="fb_xdm_frame_http" scrolling="no" frameborder="0"></iframe><iframe src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/LEdxGgtB9cN_002.html" style="border: medium none;" tab-index="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" allowtransparency="true" name="fb_xdm_frame_https" scrolling="no" frameborder="0"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/ping.html" style="display: none;" allowtransparency="true" name="f5467f628f817c" scrolling="no" frameborder="0"></iframe></div></div></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=203253883025618";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
      </div>

      <div>
        <iframe class="hn-share-iframe" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/button.html" scrolling="auto" width="75px" frameborder="0" height="20px"></iframe>
        <script>
          (function(d, t) {
            var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
            g.src = '//hnbutton.appspot.com/static/hn.js';
            s.parentNode.insertBefore(g, s);
          }(document, 'script'));
        </script>
      </div>
    </div>
  </div>
</article>

      </div>

      
    </div>

    <div class="footer">
      <div class="footer-wrapper">
        
<div class="readnext">
  
  <h3>Read Next</h3>
  <a href="http://jlongster.com/Writing-Your-First-Sweet.js-Macro"><h1>Writing Your First Sweet.js Macro</h1></a>
  <p>This is the first entry in a series about writing JavaScript macros with <a href="http://sweetjs.org/">sweet.js</a>.
 You will learn how to write your first macro, basics of pattern 
matching, and how to run the sweet.js compiler and use sourcemaps for 
debugging.</p>
 
</div>

<div id="disqus_thread"><iframe verticalscrolling="no" horizontalscrolling="no" src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/a.html" style="width: 100% ! important; border: medium none ! important; overflow: hidden ! important; height: 322px ! important;" title="Disqus" tabindex="0" allowtransparency="true" data-disqus-uid="2" id="dsq-2" scrolling="no" width="100%" frameborder="0"></iframe></div>
<script type="text/javascript">
  var disqus_shortname = 'jlongster';
  var disqus_url = window.location.href.split('?')[0];

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



        <div class="footer-text">
          <p>
            Made by <a id="browserid">James Long</a>, a senior web developer
            for <a href="http://mozilla.org/">Mozilla</a>. Feel free
            to <a href="mailto:longster@gmail.com">get in touch</a> with
            me.
          </p>
          <p>
             James Long 2012-2013
          </p>
        </div>
      </div>
    </div>

    <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/zepto.js"></script>
    <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/underscore-min.js"></script>
    <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/persona.js"></script>
    <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/main.js"></script>

    <script>
      window.CURRENT_USER = null;
    </script>
    <script src="Sweet.js%20Tutorial%20%232:%20Recursive%20Macros%20and%20Custom%20Pattern%20Classes_files/site.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-9014321-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    
  

</body></html>